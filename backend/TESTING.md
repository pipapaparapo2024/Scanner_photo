# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Backend API

## ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. Health Check (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

```powershell
Invoke-WebRequest -Uri "http://localhost:4000/health" -UseBasicParsing
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `{"status":"ok"}`

---

## üîê –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç **Firebase ID Token** –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```
Authorization: Bearer <firebase-id-token>
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **GET** `/api/users/me` - –ü–æ–ª—É—á–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –°–∫–∞–Ω—ã
- **GET** `/api/scans` - –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–∫–∞–Ω–æ–≤ (–¥–æ 50 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö)
- **POST** `/api/scans` - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π —Å–∫–∞–Ω
  ```json
  {
    "extractedText": "—Ç–µ–∫—Å—Ç, —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ"
  }
  ```

#### –ü–æ–∫—É–ø–∫–∏ (IAP)
- **POST** `/api/iap/verify` - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ RuStore
  ```json
  {
    "productId": "pack_50_scans",
    "purchaseToken": "...",
    "orderId": "..."
  }
  ```

#### –†–µ–∫–ª–∞–º–∞
- **POST** `/api/ads/reward/nonce` - –ü–æ–ª—É—á–∏—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–µ–∫–ª–∞–º—ã
- **POST** `/api/ads/reward` - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∫–ª–∞–º—ã
  ```json
  {
    "token": "<nonce-token>"
  }
  ```

---

## üß™ –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Firebase ID Token –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (React Native)
–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Firebase Auth –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑:
```typescript
import auth from '@react-native-firebase/auth';
const idToken = await auth().currentUser?.getIdToken();
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Firebase Admin SDK (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—Å—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üìù –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ Postman/curl

1. –ü–æ–ª—É—á–∏ Firebase ID Token –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```bash
curl -X GET http://localhost:4000/api/users/me \
  -H "Authorization: Bearer YOUR_FIREBASE_ID_TOKEN"
```

---

## üß™ Unit-—Ç–µ—Å—Ç—ã (Jest)

### –ó–∞–ø—É—Å–∫

```bash
npm test           # –≤—Å–µ —Ç–µ—Å—Ç—ã
npm run test:watch # watch-—Ä–µ–∂–∏–º
npm run test:coverage # —Å –æ—Ç—á—ë—Ç–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ

- **scanService** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫–∞–Ω–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞, –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —É–¥–∞–ª–µ–Ω–∏–µ
- **userService** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è
- **adService** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Ä–µ–∫–ª–∞–º—ã, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ 3 —Ç–æ–∫–µ–Ω–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **iapService** ‚Äî –ø–∞–∫–µ—Ç—ã 50/100 —Ç–æ–∫–µ–Ω–æ–≤, –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç, RuStore (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- **dateUtils** ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
- **textUtils** ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è Unicode, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –æ–±—Ä–µ–∑–∫–∞ —Ç–µ–∫—Å—Ç–∞

–¶–µ–ª—å –ø–æ–∫—Ä—ã—Ç–∏—è: **60‚Äì70%** –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: `src/__tests__/README.md`.

---

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ `/health` —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Firebase Admin SDK –ø–æ–¥–∫–ª—é—á–µ–Ω
- ‚úÖ Unit-—Ç–µ—Å—Ç—ã (Jest): 39 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —É—Ç–∏–ª–∏—Ç
- ‚è≥ –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã, –Ω–æ —Ç—Ä–µ–±—É—é—Ç Firebase ID Token –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

