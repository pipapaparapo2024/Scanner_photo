# E2E-тесты (Detox)

Автоматизация основных сценариев:

1. **Регистрация → Сканирование → История**: онбординг → выбор авторизации → регистрация (экран email) → далее скан и история (при наличии бэкенда).
2. **Покупка токенов → Сканирование**: вкладка «Аккаунт» → «Купить пакеты» → экран монетизации → кнопки покупки.
3. **Просмотр рекламы → Токены**: при нулевом балансе на экране монетизации — кнопка «Смотреть рекламу».

## Запуск

**Требования:** Android SDK, эмулятор (или устройство), Node 18+.

1. Запустите эмулятор или подключите устройство.
2. Соберите приложение и тестовый APK:
   ```bash
   npm run e2e:build
   ```
3. В отдельном терминале запустите Metro:
   ```bash
   npm start
   ```
4. Запустите E2E-тесты:
   ```bash
   npm run e2e:test
   ```
   или `npm run e2e` (то же самое).

Скриншоты при падениях сохраняются (см. `takeScreenshots: 'failing'` в `.detoxrc.js`).

## AVD (эмулятор)

По умолчанию используется `Pixel_3a_API_30_x86`. Список AVD:

- Windows: `%ANDROID_HOME%\emulator\emulator -list-avds`
- macOS/Linux: `$ANDROID_HOME/emulator/emulator -list-avds`

Свой AVD можно задать через переменную:

```bash
set DETOX_AVD=Your_AVD_Name
npm run e2e:test
```

## Конфигурация

- `.detoxrc.js` — конфиг Detox (приложение, устройства, конфигурации).
- `e2e/jest.config.js` — Jest для E2E (testEnvironment Detox, таймауты, матчи `*.e2e.js`, `*.e2e.ts`).

## Тесты

- `auth.e2e.js` — онбординг, выбор авторизации, переход к регистрации и экрану email.
- `navigation.e2e.js` — вкладки (История, Скан, Аккаунт), модалка выбора источника, переход в монетизацию.
- `monetization.e2e.js` — экран монетизации: баланс, покупки, кнопка рекламы при нулевом балансе.

Навигация и монетизация предполагают авторизованного пользователя (главный экран с табами). Без логина эти тесты могут пропускать проверки.
